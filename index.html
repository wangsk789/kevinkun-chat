<!doctype html>
<html>
  <head>
    <title>Socket.IO chat</title>
	<link rel="shortcut icon" href="#" />
  </head>
  <body>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/1.2.0/socket.io.min.js"></script>
    <script>
      
        var socket=io();
		var isLogin =false;
		
		socket.on('connect', function () {
			
			var data ={};
			data.type="connect";
			//SocketIO.connected();
			setWebViewString(data);
			console.log(JSON.stringify(data));
		});
		
		socket.on("logedin", function(username){
			isLogin = true;
			var data ={};
			data.type="logedin";
			data.username=username;
			//SocketIO.logedin(username);
			setWebViewString(data);
			console.log(JSON.stringify(data));
		});
  
		socket.on("joinedRoom", function(username, roomname, userlist){
			
			var data ={};
			data.type="joinedRoom";
			data.username=username;
			data.roomname=roomname;
			data.userlist=userlist;
			//SocketIO.joinedRoom(username, roomname, JSON.stringify(userlist));
			setWebViewString(data);
			console.log(JSON.stringify(data));
		});
		
		
		
		socket.on("roomFull", function(roomName){

			var data ={};
			data.type="roomFull";
			data.roomName=roomName;
			setWebViewString(data);
			console.log(JSON.stringify(data));
		});
		
		socket.on("leftRoom", function(username, roomname, userlist){

			var data ={};
			data.type="leftRoom";
			data.username=username;
			data.roomname=roomname;
			data.userlist=userlist;
			//SocketIO.leftRoom(username, roomname, JSON.stringify(userlist));
			setWebViewString(data);
			console.log(JSON.stringify(data));
		});
		
		socket.on("disconnect", function(){

			var data ={};
			data.type="disconnect";
			//SocketIO.disconnect();
			setWebViewString(data);
			console.log(JSON.stringify(data));
		});
		
		socket.on("gotMessageToRoom", function(user, room, content){

			var data ={};
			data.type="gotMessageToRoom";
			data.from=user;
			data.room=room;
			data.content=content;
			//SocketIO.gotMessageToRoom(user, room, content);
			setWebViewString(data);
			console.log(JSON.stringify(data));
		});
		
		socket.on("gotMessageToAll", function(user,  content){

			var data ={};
			data.type="gotMessageToAll";
			data.from=user;
			data.content=content;
			//SocketIO.gotMessageToAll(user, content);
			setWebViewString(data);
			console.log(JSON.stringify(data));
		});
		
		socket.on("gotMessageToMe", function(user, content){

			var data ={};
			data.type="gotMessageToMe";
			data.from=user;
			data.content=content;
			//SocketIO.gotMessageToMe(user, content);
			setWebViewString(data);
			console.log(JSON.stringify(data));
		});
		
		socket.on("err", function(err){

			var data ={};
			data.type="error";
			data.error=err;
			//SocketIO.gotError(err);
			setWebViewString(data);
			console.log(JSON.stringify(data));
		});

	function setWebViewString(d){
		if(window.AppInventor){
			window.AppInventor.setWebViewString(JSON.stringify(d));
		}
	}
	
	function login(username){
		socket.emit("login", username);
	}
	
	function joinRoom(roomname){
		if(isLogin){
			socket.emit("joinRoom", roomname);
		}
		
	}
	  	  
	function leaveRoom(roomname){
		if(isLogin){
			socket.emit("leaveRoom", roomname);
		}
	  }
	  
	function messageToUser(user, content){
		if(isLogin){
			socket.emit("messageToUser",user,  content);
		}
	}
	function messageToRoom(room,content){
		if(isLogin){
			socket.emit("messageToRoom", room, content);
		}
	}
	
	function messageToAll(content){
		if(isLogin){
			socket.emit("messageToAll", content);
		}
	}
    </script>
  </body>
</html>
