<!doctype html>
<html>
  <head>
    <title>Socket.IO chat</title>

  </head>
  <body>
    <script src="https://cdn.socket.io/socket.io-1.2.0.js"></script>
    <script>
      
        var socket;
		socket=io();
		socket.on('connect', function () {
			
			var data ={};
			data.type="connect";
			setWebViewString(data);
			console.log(JSON.stringify(data));
		});
  
		socket.on("joinedRoom", function(userList){

			var data ={};
			data.type="joinedRoom";
			data.users=userList;
			setWebViewString(data);
			console.log(JSON.stringify(data));
		});
		
		socket.on("otherJoinedRoom", function(newUser, userList){

			var data ={};
			data.type="otherJoinedRoom";
			data.user=newUser;
			data.users=userList;
			setWebViewString(data);
			console.log(JSON.stringify(data));
		});
		socket.on("roomFull", function(roomName){

			var data ={};
			data.type="roomFull";
			data.roomName=roomName;
			setWebViewString(data);
			console.log(JSON.stringify(data));
		});
		
		socket.on("otherLeftRoom", function(user, userList){

			var data ={};
			data.type="otherLeftRoom";
			data.user=user;
			data.users=userList;
			setWebViewString(data);
			console.log(JSON.stringify(data));
		});
		
		socket.on("message", function(user, eventName, eventMessage){

			var data ={};
			data.type="message";
			data.from=user;
			data.title=eventName;
			data.content=eventMessage;
			setWebViewString(data);
			console.log(JSON.stringify(data));
		});

	function setWebViewString(d){
		if(window.AppInventor){
			window.AppInventor.setWebViewString(JSON.stringify(d));
		}
	}
	
	function joinRoom(room, user){
		socket.emit("join", room, user);
	}
	  	  
	function leaveRoom(){
		socket.emit("leave");
	  }
	  
	function sendMessage(title, content){
		socket.emit("message", title, content);
	}
    </script>
  </body>
</html>
